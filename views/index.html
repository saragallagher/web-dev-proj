<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="p5.js" charset="utf-8"></script>
    <title>ExciteBike</title>
  </head>
  <body>
    <script type="text/javascript">

          class Sprite {
            constructor(props){
              this.x = props.x
              this.y = props.y
              this.w = props.w
              this.h = props.h
              this.vx = props.vx || 0
              this.vy = props.vy || 0
              this.color = props.color || 'white'
              this.rotationAngle = props.rotationAngle || 0
            }
            render(){
            }
            update(){
              this.x = this.x + this.vx
              this.y = this.y + this.vy
            }
            hits(otherSprite){
              return this.x < otherSprite.x + otherSprite.w &&
                this.x + this.w > otherSprite.x &&
                this.y < otherSprite.y + otherSprite.h &&
                this.y + this.h > otherSprite.y
            }
          }

          class Motorcycle extends Sprite{
            render(){
              // rectMode(CENTER)
              push()
              translate(this.x, this.y)

              rotate(this.rotationAngle)
              fill(this.color)
              rect(0,0, this.w, this.h)
              pop()
            }
            update(){
              super.update()
              if (this.hits(mountain)) {
                this.color = 'red'
                this.vy = -1
              } else {
                this.color = 'white'
                if (this.y >= 320) {
                  this.vy = 0
                } else{
                  this.vy = 1
                }
              }

              if (this.rotationAngle > -PI/2 && (this.hits(mountain) || keyIsDown(LEFT_ARROW))) {
                this.rotationAngle -= 0.1
              }
              else if(this.rotationAngle < 0){
                this.rotationAngle += 0.1
                if (this.rotationAngle > 0) this.rotationAngle = 0 // fix this later
              }
            }
          }

          class Mountain extends Sprite{
            render(){
              // rectMode(CENTER)
              push()
              translate(this.x, this.y)

              rotate(this.rotationAngle)
              fill(this.color)
              rect(0,0, this.w, this.h)
              pop()
            }
            update(){
              super.update()
              if (this.x + this.w < 0) {
                this.x = 640
              }
            }
          }

          var motorcycle
          var mountain

          function setup() {
            createCanvas(640, 480)
            motorcycle = new Motorcycle({x: 160, y: 320, w: 30, h: 20, color: 'white'})
            mountain = new Mountain({x: 640, y: 290, w: 100, h: 50, color: 'yellow', vx: -1})
          }

          function draw() {
            background(0, 255, 255)
            mountain.update()
            mountain.render()

            motorcycle.update()
            motorcycle.render()

          }


    </script>
  </body>
</html>
